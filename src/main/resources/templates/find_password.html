<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>找 回 密 码</title>
</head>
<script th:src="@{/jquery-1.12.4.min.js}"></script>
<script th:src="@{/layer/layer.js}"></script>
<script th:src="@{/jquery-validation-1.14.0/dist/jquery.validate.min.js}"></script>
<script th:src="@{/jquery-validation-1.14.0/dist/localization/messages_zh.js}"></script>
<script th:src="@{/bootstrap3/bootstrap3-typeahead.min.js}"></script>
<script th:src="@{/easyui/jquery.easyui.min.js}"></script>
<!--提示框-->
<script th:src="@{/bootbox.min.js}"></script>
<!--bootstrap-->
<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.css}" />
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap-theme.min.css}" />
<!--select2 下拉框支持搜索-->
<link rel="stylesheet" th:href="@{/select2-develop/dist/css/select2.min.css}" />
<script th:src="@{/select2-develop/dist/js/select2.min.js}"></script>
<!--评分-->
<link rel="stylesheet" th:href="@{/comment_star/css/star-rating.css}"  media="all" type="text/css"/>
<link rel="stylesheet" th:href="@{/comment_star/themes/krajee-svg/theme.css}"  media="all" type="text/css"/>
<script th:src="@{/comment_star/js/star-rating.js}" ></script>
<script th:src="@{/comment_star/js/locales/zh.js}" ></script>
<script th:src="@{/comment_star/themes/krajee-svg/theme.js}" ></script>
<!--dataTable 按顺序-->
<link rel="stylesheet" th:href="@{/static/dataTable/css/dataTable.css}" media="all" type="text/css"/>
<script th:src="@{/static/dataTable/js/jquery.dataTables.js}" ></script>
<script th:src="@{/static/dataTable/js/jquery.dataTables.bootstrap.js}" ></script>
<!--dateSelect-->
<script th:src="@{/date_select/dateSelect.js}" ></script>
<!--datetimepicker  添加static/bootstrap/fonts-->
<link rel="stylesheet" th:href="@{/datetimepicker/bootstrap-datetimepicker.min.css}"  media="all" type="text/css"/>
<script th:src="@{/datetimepicker/date_time_range/daterangepicker.js}" ></script>
<script th:src="@{/datetimepicker/date_time_range/moment.min.js}" ></script>
<script th:src="@{/datetimepicker/date-time/bootstrap-datetimepicker.js}" ></script>
<script th:src="@{/datetimepicker/date-time/bootstrap-datetimepicker.zh-CN.js}" ></script>
<!--upload file-->
<script th:src="@{/file.upload.util.js}"></script>
<!--csrfValidateCommon-->
<script th:src="@{/common/csrfValidateCommon.js}"></script>

<script>
    $(function(){
        $('input[data-star-hook]').rating({
            size:'sm',
            step:1,
            showClear:false,
            language:'zh',
            theme: 'krajee-svg',
            filledStar: '<span class="krajee-icon krajee-icon-star"></span>',
            emptyStar: '<span class="krajee-icon krajee-icon-star"></span>'
        });
    });
</script>
<style>
    .eo-gap{
        margin-left: 50px;
        width: 120px;
        display: inline-block
    }
    .eo-star-rating-contianer .eo-star-rating-bar .rating-container{
        display: inline-block;!important;
    }
    .eo-star-rating-bar{
        text-align: center;
    }
    /*面包屑导航*/
    .breadcrumb > li + li:before {
        color: #CCCCCC;
        content: "/ ";
        padding: 0 5px;
    }
    .error{
        color:red;
    }
    .red-point{
        position: relative;
    }
    .red-point::before{
        content: " ";
        border: 3px solid red;/*设置红色*/
        border-radius:3px;/*设置圆角*/
        position: absolute;
        z-index: 1000;
        right: 0%;
        margin-right: -5px;
        margin-top: -5px;
    }
</style>
<body>
<!--面包屑导航-->
<ul class="breadcrumb">
    <li><a href="#">我的主页</a></li>
    <li><a href="#">2021</a></li>
    <li class="active">十一月</li>
</ul>
<center>
    <!--导航栏 start-->
    <nav class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">菜鸟教程</a>
            </div>
            <div>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">iOS</a></li>
                    <li><a href="#">SVN</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            Java
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#">jmeter</a></li>
                            <li><a href="#">EJB</a></li>
                            <li><a href="#">Jasper Report</a></li>
                            <li class="divider"></li>
                            <li><a href="#">分离的链接</a></li>
                            <li class="divider"></li>
                            <li><a href="#">另一个分离的链接</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!--导航栏 end-->
    <div style="margin-top:20px;">
        <form class="form-horizontal" role="form" id="queryUserListInfoForm">

            <div class="panel panel-primary" style="margin-bottom: 40px;">

                <div class="panel-heading">
                    <h2 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#addEventOrderPanel">
                            找 回 密 码
                        </a>
                    </h2>
                </div>

                <div id="addEventOrderPanel" class="panel-collapse collapse" style="margin-bottom: 40px;">

                        <table class="table">
                            <tr>
                                <td>
                                    <div class="input-group">
                                                              <span class="input-group-addon">
                                                                  <div style="width: 100px;">用户:</div>
                                                              </span>
                                        <div>
                                            <input id="userName" name="userName" type="text" placeholder="用户名/手机号/邮箱"/>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                                              <span class="input-group-addon">
                                                                  <div style="width: 100px;">密码:</div>
                                                              </span>
                                        <div>
                                            <input id="password" name="password" type="text" placeholder="密码"/>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                                              <span class="input-group-addon">
                                                                  <div style="width: 100px;">手机号码:</div>
                                                              </span>
                                        <div>
                                            <input id="phone" name="phone" type="text" placeholder="手机号码"/>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group" id="eventOrderAdd_DeptDiv_city">
                                            <span class="input-group-addon">
                                                      <div style="width: 100px;">城市：</div>
                                            </span>
                                        <div>
                                            <select  id="eventOrderAdd_city" name="city" class="singleSelect" style="width: 200px;">
                                                <option value="">--请选择--</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr id="newEventOrder_errorDeviceOrderTr">
                                <td colspan="2">
                                    <label style="color: red" id="errorNotifier"></label>
                                </td>
                            </tr>
                            <tr id="newEventOrder_errorDeviceOrderTr1">
                                <td colspan="2">
                                    <label><div id="newEventOrder_errorDeviceOrder" style="color: red"></div></label>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <div class="input-group">
                                                    <span class="input-group-addon">
                                                              <div style="width: 100px;">商家名称：</div>
                                                    </span>
                                        <div>
                                            <input type=hidden id="eventOrderAdd_initiatorSellerNo" name="eventOrderAdd_initiatorSellerNo">
                                            <input type="text" class="form-control" id="eventOrderAdd_initiatorSellerName" name="eventOrderAdd_initiatorSellerName" maxlength="50"/>
                                        </div>
                                    </div>
                                </td>

                                <td>
                                    <div class="input-group" id="eventOrderAdd_DeptDiv">
                                            <span class="input-group-addon">
                                                      <div style="width: 100px;">所属事业部：</div>
                                            </span>
                                        <div>
                                            <select  id="eventOrderAdd_deptartmentId" name="deptartmentId" class="singleSelect" style="width: 200px;">
                                                <option value="">--请选择--</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>

                                <td>
                                    <div class="input-group" id="eventOrderAdd_WarehouseDiv">
                                                              <span class="input-group-addon">
                                                                  <div style="width: 100px;">所属仓库：</div>
                                                              </span>
                                        <div>
                                            <select
                                                    id="eventOrderAdd_warehouse" name="eventOrderAdd_warehouse"
                                                    onchange="newEventOrderAddEventTypeChange()">
                                                <option value="">---请选择---</option>
                                                <option value="2020">   2020</option>
                                                <option value="2019">   2019</option>
                                                <option value="2018">   2018</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>

                                <td>
                                    <div class="input-group">
                                                              <span class="input-group-addon">
                                                                  <div style="width: 100px;">类型：</div>
                                                              </span>
                                        <div>
                                            <select
                                                    id="newEventOrderAdd_eventClass" name="eventClass" onchange="newEventOrderAddEventClassChange()">
                                                <option value="">--请选择--</option>
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="input-group">
                                          <span class="input-group-addon">
                                              <div style="width: 100px;">单据号：</div>
                                          </span>
                                        <div>
                                            <input class="input-group" type="text" id="newEventOrderAdd_bizOrderNo" name="newEventOrderAdd_bizOrderNo" maxlength="50"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <label style="padding-left: 126px;color: red" id="newEventOrderAdd_eventAnnotation"><div id="newEventOrder_eventSubmitTooltip"></div></label>
                                </td>
                            </tr>



                            <div id="newEventOrderBasicDataHiddenDiv" hidden>
                                <div class="input-group" id="newEventOrderAdd_DeptDiv">
                                    <span class="input-group-addon">
                                              <div style="width: 100px;">事业部：</div>
                                    </span>
                                    <div>
                                        <select class="form-control singleSelect" style="width: 450px;" id="newEventOrderAdd_deptartmentId" name="newEventOrderAdd_deptartmentId">
                                            <option value="">--请选择--</option>
                                            <option value="1">事业部B1</option>
                                            <option value="2">事业部B2</option>
                                            <option value="3">事业部B3</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="input-group" id="newEventOrderAdd_shopDiv">
                                    <span class="input-group-addon">
                                              <div style="width: 100px;">店铺：</div>
                                    </span>
                                    <div>
                                        <select class="form-control"  id="newEventOrderAdd_shopId" name="shopId">
                                            <option value="">--请选择--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="input-group" id="newEventOrderAdd_WarehouseDiv">
                                      <span class="input-group-addon">
                                          <div style="width: 100px;">仓库：</div>
                                      </span>
                                    <div>
                                        <select class="form-control" id="newEventOrderAdd_warehouse" name="newEventOrderAdd_warehouse">
                                            <option value="">--请选择--</option>
                                            <option value="1">--测试仓库--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="input-group" id="newEventOrderAdd_LinkManDiv">
                                          <span class="input-group-addon">
                                              <div style="width: 100px;">联系人：</div>
                                          </span>
                                    <div>
                                        <input type="text" class="form-control" id="newEventOrderAdd_linkMan" name="newEventOrderAdd_linkMan" maxlength="50"/>
                                    </div>
                                </div>
                                <div class="input-group" id="newEventOrderAdd_TelDiv">
                                          <span class="input-group-addon">
                                              <div style="width: 100px;">联系电话：</div>
                                          </span>
                                    <div>
                                        <input type="text" class="form-control" id="newEventOrderAdd_tel" name="newEventOrderAdd_tel" maxlength="20"/>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" id="getOrderInfo_flag" name="getOrderInfo_flag" value="false"/>
                            <input type="hidden" id="exchangeFlag" value="0"/>

                            <tr>
                                <td>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                 <div style="width: 100px;">未读单号：</div>
                                            </span>
                                        <div  class="form-control"  id="readStatus_div"></div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group" id="newEventOrderAdd_demo">
                                            <span class="input-group-addon">
                                                <div style="width: 100px;">显示当前时间：</div>
                                            </span>
                                        <div class="form-control" id="demo" disabled="disabled">上午00:00:00</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                 <label class="control-label">创建时间：</label>
                                            </span>
                                        <input type="text" class="form-control timeSelect cursor-pointer "
                                               id="eventOrderList_createTimeStart" name="createTime"
                                               maxlength="50" />
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                  <label class="control-label">结束时间：</label>
                                            </span>
                                        <input type="text" class="form-control timeSelect cursor-pointer "
                                               id="eventOrderList_createTimeEnd" name="createTimeEnd"
                                               maxlength="50" />
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <div class="input-group">
                                             <span class="input-group-addon">
                                                 <div style="width: 100px;">事件描述：</div>
                                             </span>
                                             <div>
                                                 <textarea id="newEventOrderAdd_remark" name="newEventOrderAdd_remark" rows="5" cols="20" class="form-control {required:true,messages:{required: '必选项'}}" maxlength="500"></textarea>
                                             </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                 <div style="width: 100px;">image：</div>
                                             </span>
                                            <div  class="form-control" >
                                                <a  href='user/fileDownload?id=1' style="margin-right: 50px;" title="白冰.png"><div th:text="${fileName}"></div></a>
                                            </div>
                                    </div>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                     <div style="width: 100px;">业务标识：</div>
                                            </span>
                                            <div >
                                                <select id="businessSign" name="businessSign" class="form-control" style="width: 200px;">
                                                    <option value="">---请选择---</option>
                                                    <option th:each="dict : ${businessSignList}" th:value="${dict.code}" th:text="${dict.name}">
                                                </select>
                                            </div>
                                    </div>
                                    <div class="input-group">
                                            <span class="input-group-addon">
                                                     <div style="width: 100px;">入库类型：</div>
                                            </span>
                                            <div >
                                                <select id="receiptsPerformType" name="receiptsPerformType" class="singleSelect" style="width: 200px;">
                                                    <option value="">---请选择---</option>
                                                </select>
                                            </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <a href="#" class="thumbnail"><!--缩略图-->
                                            <img src="https://img2.baidu.com/it/u=2304960815,3164512385&fm=253&fmt=auto?w=800&h=1200" alt="白冰" width="150px" height="150px">
                                        </a>
                                    </div>
                                </td>

                            </tr>
                            <tr>
                                <td colspan="2">
                                    <div class="input-group">
                                          <span class="input-group-addon">
                                              <div style="width: 100px;">上传文件：</div>
                                          </span>
                                        <div class="" id="send_content_div">
                                        <span style="">
                                            <div class="m-l-110">
                                                <div class="m-r-10">
                                                    <div id="submit_file_list"></div>
                                                    <div id="submit_image_list"></div>
                                                    <a class="left form-control red" href="javascript:" data-toggle="modal" data-target="#myModalFileUpload">点击上传</a>
                                                    <!-- Modal -->
                                                    <div class="modal fade" id="myModalFileUpload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                                        <div class="modal-dialog  modal-lg " role="document">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                                    <h4 class="modal-title" id="myModalLabel">文件上传</h4>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <iframe src="/toUpload" width="868px" height="500px" frameborder="no" border="0"></iframe>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </span>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <div class="input-group">
                                        <table>
                                            <div id="submit_file_list_file"></div>
                                            <div id="submit_image_list_image"></div>
                                            <tr>
                                                <td width="55%">
                                                    <div id="image_list"></div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width="45%">
                                                    <ul id="file_list"> </ul>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </td>
                            </tr>

                            <tr hidden="hidden">
                                <td>
                                    <div class="input-group">
                                       <span class="input-group-addon">
                                           <div style="width: 100px;">事件描述444：</div>
                                       </span>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td id="td_downWMS">
                                    <div id="div_v1" >
                                        <input class="btn btn-primary" type='button' value='查看' onclick='newEventOrderAddEventClassChange(1)'/>
                                    </div>
                                </td>
                            </tr>
                        </table>

                    <div class="panel-body">
                        <table class="table table-striped table-bordered table-hover">
                            <tbody>
                            <tr>
                                <td class="td_title" style="width:20%;">备注：</td>
                                <td>
                                    <textarea  rows="3" name="remarksss" id="remarksss" style="width:90%;"></textarea>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                        <p>
                            <!--<input type="submit" class="btn btn-primary" value="提交">-->
                            <div class="row form-group">
                                <div class="col-sm-offset-2 col-sm-7 center">
                                    <button id="addEventOrderBtn" data-loading-text="下发中" type="button" class="btn btn-primary">下发</button>
                                </div>
                            </div>
                            <div class="row form-group">
                                <div class="col-sm-offset-2 col-sm-7 center">
                                    <button id="soExceptionCentre" type="button" class="btn btn-primary" >so异常中心处理</button>
                                    <button id="insertBillException" type="button" class="btn btn-primary" >新建异常单据</button>
                                    <button id="billException" type="button" class="btn btn-primary" >异常单据处理</button>
                                    <button id="resumeBillExceptionCentreForm" type="button" class="btn btn-primary">批量处理</button>
                                    <button id="remarkTest" type="button" class="btn btn-primary">remarkTest</button>
                                </div>
                            </div>

                            <button id="queryUserList" data-loading-text="载入中" type="button" class="btn btn-primary">查询</button>
                            <button id="exportUserList" type="button" class="btn btn-primary">导出</button>
                            <button id="initBsicDataTags" type="button" class="btn btn-primary">初始化</button>
                            <a href="toLogin" class="btn btn-warning">已有账号?前去登录</a>
                            <button id="comment" type="button" class="btn btn-primary eo-gap" data-toggle="modal" data-target="#eventOrderSolvedStar" >
                                <h4>评价</h4>
                            </button>
                            <button id="eventOrderRestitution" type="button" class="btn btn-primary eo-gap" data-toggle="modal" data-target="#eventOrderRestitutionPanel" style="width: 135px;">
                                <h4>转赔付</h4>
                            </button>
                            <button id="eventOrderRestitutionMCSS" type="button" class="btn btn-primary eo-gap" data-toggle="modal" data-target="#eventOrderRestitutionMCSSPanel" style="width: 135px;">
                                <h4>转赔付MCSS</h4>
                            </button>
                            <button id="leaveMsgSubmit" type="button" class="btn btn-primary">留言</button>
                            <button id="echo" type="button" class="btn btn-primary eo-gap" >echo测试</button>
                            <button id="mergeItem-form-sumbit" type="button" class="btn btn-primary eo-gap" >保存</button>
                        </p>


                </div>
            </div>

        </form>

    </div>

    <div class="eoMainListMask">
        <div class="table-responsive" style="overflow: auto">
            <div style="width: 120%">
                <table id="userList_query-table"
                       class="dataTable table table-striped table-bordered table-hover">
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary" style="margin-bottom: 40px;">

        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#addEventOrderPanel">
                    下载进度
                </a>
            </h4>
        </div>
        <div class="progress progress-striped">
            <div class="progress-bar progress-bar-success" role="progressbar"
                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                 style="width: 90%;">
                <span class="sr-only">90% 完成（成功）</span>
            </div>
        </div>
        <div class="progress progress-striped">
            <div class="progress-bar progress-bar-info" role="progressbar"
                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                 style="width: 30%;">
                <span class="sr-only">30% 完成（信息）</span>
            </div>
        </div>
        <div class="progress progress-striped">
            <div class="progress-bar progress-bar-warning" role="progressbar"
                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                 style="width: 20%;">
                <span class="sr-only">20% 完成（警告）</span>
            </div>
        </div>
        <div class="progress progress-striped">
            <div class="progress-bar progress-bar-danger" role="progressbar"
                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                 style="width: 10%;">
                <span class="sr-only">10% 完成（危险）</span>
            </div>
        </div>
    </div>

    <div class="modal fade" id="eventOrderRestitutionPanel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <span class="modal-title"
                          style="display:inline-block;text-align: left;width: 100%;font-size: 20px;font-weight: bold">填写转赔付原因</span>
                </div>
                <div  class="panel-collapse">
                    <table class="table">
                        <tr id = "tr_restitution_price">
                            <td style="vertical-align: middle;width: 25%" align="right"><label class="control-label">赔付金额：</label></td>
                            <td style="vertical-align: middle;width: 75%" align="left">
                                <input id="restitution_num"  onkeyup="clearNoNum(this)"  type="text">&nbsp;&nbsp;&nbsp;&nbsp;元
                            </td>
                        </tr>
                        <tr id = "tr_restitution_content">
                            <td style="vertical-align: middle;width: 25%" align="right"><label class="control-label">转赔付原因：</label></td>
                            <td style="vertical-align: middle;width: 75%" align="left">
                                <textarea id="restitution_content" name="restitution_content" rows="5" cols="20" class="form-control {required:true,messages:{required: '必选项'}}" maxlength="500"></textarea>
                            </td>
                        </tr>


                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="leaveRestitutionSubmit" type="button" class="btn btn-primary">提交</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="eventOrderRestitutionMCSSPanel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <span class="modal-title" style="display:inline-block;text-align: left;width: 100%;font-size: 20px;font-weight: bold">关联相关JDV单号</span>
                </div>
                <div  class="panel-collapse">
                    <table class="table">
                        <tr id = "tr_restitution_jdvOrderNo">
                            <td style="vertical-align: middle;width: 25%" align="right">
                                <label class="control-label">JDV单号：</label>
                            </td>
                            <td style="vertical-align: middle;width: 75%" align="left">
                                <input id="restitution_jdvOrderNo"   type="text">
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="leaveRestitutionMCSSSubmit" type="button" class="btn btn-primary">提交</button>
                </div>
            </div>
        </div>
    </div>

    <div hidden="hidden" class="modal fade" id="eventOrderSolvedStar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <span class="modal-title" style="display:inline-block;text-align: center;width: 100%;font-size: 20px;font-weight: bold">欢迎您对我们的服务进行评价</span>
                </div>
                <div class="modal-body eo-star-rating-contianer">
                    <div class="eo-star-rating-bar">
                        <span style="font-size: 16px;font-weight: bold">处理时效</span> &nbsp;<input id="eo-star-rating1"  data-star-hook type="text">
                    </div>
                    <div class="eo-star-rating-bar">
                        <span style="font-size: 16px;font-weight: bold">服务态度</span> &nbsp;<input id="eo-star-rating2"  data-star-hook type="text">
                    </div>
                    <div class="eo-star-rating-bar">
                        <span style="font-size: 16px;font-weight: bold">服务质量</span> &nbsp;<input id="eo-star-rating3" data-star-hook type="text">
                    </div>
                    <div>
                        <span ><div style="width: 100px;">其它想说的：</div> </span>
                        <textarea id="otherSay" name="otherSay" rows="3" cols="10" class="form-control {required:true,messages:{required: '必选项'}}" maxlength="300"></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="commentSubmit" type="button" class="btn btn-primary">提交</button>
                </div>
            </div>
        </div>
    </div>

</center>

</body>
<script>
    var soExceptionTypeFlag = "-";
    //==================================================================================================================
    //==================================================================================================================
    /*页面加载事件  */
    $(function () {
        debugger;
        /*$("#newEventOrderAdd_deptartmentId").addClass("singleSelect");*/
        //$("#newEventOrderAdd_deptartmentId").removeClass("singleSelect");
        /*bootstrap 标题可展开关闭*/
        jQuery('.collapse').collapse();
        /*select2 下拉框支持搜索*/
        $('.singleSelect').select2();
        //默认时间最近三个月
        getDefaultData();

        /*获取访问的url  参数*/
        translateUrl();
        /*未读设置小红色圆点*/
        readStatus(20000103872, "CWO0020000103872");
        // 自动补全 模糊查询
        linkSelect('eventOrderAdd_initiatorSellerName', 'eventOrderAdd_initiatorSellerNo', 'eventOrderAdd_deptartmentId', 'eventOrderAdd_warehouse', null, 'eventOrderAdd_city');
        //初始化信息
        initInformation();
        //初始化仓库信息
        initWarehouse();
        //加载数据
        eventOrder.loadEventOrder();
        //上传附件
        uploadFile();
        //获取下拉框的值和文本
        getSelectValue();
        //checkbox
        getCheckbox();
        //批量恢复
        resumeBillExceptionCentre();
        remarkTest();
     });
    //==================================================================================================================
    //==================================================================================================================
    function getDefaultData() {
        debugger
        $('.timeSelect').datetimepicker({
            format: 'yyyy-mm-dd hh:ii:ss',
            language: 'zh-CN', //汉化
        });
        $('.timeSelect').datetimepicker({
            format: 'yyyy-mm-dd',
            language: 'zh-CN', //汉化
            weekStart: 1, //一周从哪一天开始。0（星期日）到6（星期六）
            autoclose: true, //当选择一个日期之后是否立即关闭此日期时间选择器
            startView: 2,  //日期时间选择器打开之后首先显示的视图   // 0 or 'hour' 为小时视图
                                                                // 1 or 'day' 为天视图
                                                                // 2 or 'month' 为月视图（为默认值）
                                                                // 3 or 'year'  为年视图
                                                                // 4 or 'decade' 为十年视图
            todayBtn: true, // 如果此值为true 或 "linked"，则在日期时间选择器组件的底部显示一个 "Today" 按钮用以选择当前日期。如果是true的话，"Today" 按钮仅仅将视图转到当天的日期，如果是"linked"，当天日期将会被选中。
            todayHighlight:true, //如果为true, 高亮当前日期
            minView: 2,     //0	从小时视图开始，选分
                            //1	从天视图开始，选小时
                            //2	从月视图开始，选天
                            //3	从年视图开始，选月
                            //4	从十年视图开始，选年
            forceParse: true,  //当选择器关闭的时候，是否强制解析输入框中的值
        });
        // var sdtime1 = new Date('2018-03-22 16:14:55')
        // var sdtime2 = sdtime1.setHours(sdtime1.getHours() -1)//小时
        // var sdtime3 = new Date().setDate((new Date().getDate()-7))//7天
        // var sdtime4 = new Date().setMonth((new Date().getMonth()-1))//一个月
        // var sdtime5 = new Date().setFullYear((new Date().getFullYear()-1))//一年
        var startDate = new Date().setMonth((new Date().getMonth()-3))//减3个月
        $("#eventOrderList_createTimeStart").datetimepicker("setDate", new Date(startDate));
        $("#eventOrderList_createTimeEnd").datetimepicker("setDate", new Date());
    }
    //==================================================================================================================
    //==================================================================================================================
    function getSelectValue() {
        debugger;
        var options = $("#businessSign option:selected");
        var value = options.val();
        var text = options.text();
    }
    //==================================================================================================================
    //==================================================================================================================
    function initInformation(){
        const errorDeviceOrderId = "20000103872";
        const errorDeviceOrderNo = "CWO0020000103872";
        /*javascript:void(0) 当点击超级链接时，什么都不发生*/
        const text = "<a href=\"javascript:void(0)\" style=\"color: blue\" " +
            "onclick=\"newEventOrderAddEventClassChange('" + errorDeviceOrderId + "')\">" + errorDeviceOrderNo + "</a>";
        /*text 识别内容不识别标签   html 能识别标签*/
        $("#newEventOrder_eventSubmitTooltip").text("事件注释：您好，请填写系统中对应的单据单号，以确保单号唯一性及准确流转。");

        $("#errorNotifier").text("单据号不正确，请核对后重新输入");
        $("#newEventOrder_errorDeviceOrder").html("输入单据号所属伙伴已发起异常报备单，请点击查看报备单详情" + text);

        $("#newEventOrder_errorDeviceOrderTr").hide();
        $("#newEventOrder_errorDeviceOrderTr1").hide();

        $("#receiptsPerformType").attr("disabled", true);
    }

    //==================================================================================================================
    //==================================================================================================================
    //单据号
    $("#userName").on("blur", function () {
        debugger;
        const username = $("#userName").val().trim(); //去掉字符串前后两端的空格
        if (null == username || '' == username) {
            layer.msg("用户名为空", {icon: 5});
            return;
        }

        $("#newEventOrder_errorDeviceOrderTr").hide();
        if ($("#newEventOrder_errorDeviceOrderTr").is(":visible")) { // .is(":visible") 是否可见 返回 true or false
            console.error("false");
        }
        $("#newEventOrder_errorDeviceOrderTr").show();
        if ($("#newEventOrder_errorDeviceOrderTr").is(":visible")) {
            $("#newEventOrder_errorDeviceOrderTr").hide();
        }

        if(username == "查看") {
            const div = $("#div_v1");
            div.hide();
            //操作列重写
            const menu = [];
            menu.push("<div id='div_v2' class='btn-group'>");
            menu.push("<button id='btnEoDetail' name='btnEoDetail' findDetail(" + username + ")' >下发中....</button>");
            menu.push("</div>");
            $("#td_downWMS").html(menu.join(''));
            layer.msg("填充下发中。。。。。按钮", {icon: 5});
            return;
        }

        const flag = $('#getOrderInfo_flag').val();

        if(username == "错误单号"){
            $("#newEventOrder_errorDeviceOrderTr").show();
            $("#newEventOrder_errorDeviceOrderTr1").show();
            layer.msg("错误单号 填充错误提示", {icon: 5});
            return;
        }

        const bizType = $("#password").val();
        const bizOrderNo = $("#userName").val();
        if ((bizType != null && bizType != "" && bizOrderNo != null && bizOrderNo != "" && bizType != 14) || (bizType == 14 && !bizOrderNo.startsWith("BR"))) {
            alert("校验单号");
            return;
        }

        if (username.startsWith("BR")) {
            layer.msg("BR开头的单号。。。。", {icon: 5});
            return;
        }
        if(username.slice(0,2) === "BR"){
            layer.msg("BR开头的单号。。。。", {icon: 5});
            return;
        }

        if (username === 'success') {
            layer.msg("success", {icon: 6});
            return;
        }
        if (username === 'error') {
            $('#userName').val('');
            $('#newEventOrderAdd_remark').val('');
            layer.msg("error", {icon: 5});
            return;
        }
    });

    //
    $("#newEventOrderAdd_remark").on("blur", function () {
        const remark = $("#newEventOrderAdd_remark").val();
        const username = $("#userName").val();
        if(username === "" && remark !== ''){
            layer.msg("请输入单号", {icon: 5});
            $('#newEventOrderAdd_remark').val('');
        }
    });

    //==================================================================================================================
    //==================================================================================================================

    function initWarehouse(){
        const param = {
            userName: "111",
        };
        loadWarehouse(param);
    }

    function loadWarehouse(param){
        debugger;
        //获取所属合作伙伴下的仓
        var soInfo_warehouse = $("#newEventOrderAdd_eventClass");
        soInfo_warehouse.empty();
        soInfo_warehouse.append('<option value="">请选择</option>');
        $.ajax({
            "type": "post",
            "url": "test/queryWarehouseByPartnerNo.do",
            "dataType": "json",
            "data": param,
            success: function (data) {
                const soInfo_warehouse = $("#newEventOrderAdd_eventClass");
                soInfo_warehouse.empty();
                let str = '<option value="">--请选择--</option>';
                for (const o in data) {
                    str += '<option value="' + data[o].warehouseNo + '">' + data[o].warehouseName + '</option>';
                }
                soInfo_warehouse.append(str)
            }
        });
    }

    //==================================================================================================================
    //==================================================================================================================
    function translateUrl() {
        var test = window.location.host;

        var url = location.search; //获取url中"?"符后的字串
        if (url.indexOf("?") != -1) { //判断是否有参数
            var str = url.substr(1); //从第一个字符开始 因为第0个是?号 获取所有除问号的所有符串
            var strs = str.split("="); //用等号进行分隔 （因为知道只有一个参数 所以直接用等号进分隔 如果有多个参数 要用&号分隔 再用等号进行分隔）
            //直接弹出第一个参数 （如果有多个参数 还要进行循环的）
            layer.msg(strs[1], {icon: 6});//直接弹出第一个参数 （如果有多个参数 还要进行循环的）
            if (strs[0] != null && strs[0] != '' && strs[0] == 'id' && strs[1] != null && strs[1] != '' && strs[1] == '1') {
                window.location.href = "https://mail.qq.com";
            }
        }
    }

    //==================================================================================================================
    //==================================================================================================================
    function readStatus(id, eoNo) {
        var readStatus = [];
        var eleEoNo = '<div id=\"eoId'+ id +'\"><span class="red-point">'+eoNo+'</span></div>';
        readStatus.push(eleEoNo);
        $("#readStatus_div").html(readStatus.join(''));
    }

    //一级问题类型变更触发
    function newEventOrderAddEventTypeChange() {

    }

    //二级事件类型变更触发
    function newEventOrderAddEventClassChange(id) {
        alert("["+id+"]");
    }

    //==================================================================================================================
    //==================================================================================================================
    /**
     * 校验必填项
     * @param field
     * @returns {boolean}
     */
    function isEmpty(field) {
        if (field == null || field == "" || field == undefined) {
            return true;
        }
    }
    //==================================================================================================================
    //==================================================================================================================
    /**
     * 商家--事业部--店铺/仓库  三级联动
     * @param sellerNameId    一级seller控件（商家名称）的id
     * @param sellerIdId      一级seller控件（商家ID）的id
     * @param deptId          二级dept控件的id
     * @param warehouseId     三级warehouse控件的id   传入NULL则此级不作为联动对象
     * @param shopId          三级shop控件的id   传入NULL则此级不作为联动对象
     */
    function linkSelect(sellerNameId, sellerIdId, deptId, warehouseId, shopId, cityId) {
        debugger;
        // 初始化组件ID
        sellerNameId = '#' + sellerNameId;
        sellerIdId = '#' + sellerIdId;
        deptId = '#' + deptId;

        if (warehouseId != null && warehouseId != '') {
            warehouseId = '#' + warehouseId;
        }
        if (shopId != null && shopId != '') {
            shopId = '#' + shopId;
        }
        if (cityId != null && cityId != '') {
            cityId = '#' + cityId;
        }


        // 自动补全 模糊查询
        autoComplete(sellerNameId, 'user/getAllSeller.do', null, sellerIdId);

        // 第二、第三置为无效
        $(deptId).attr("disabled", true);

        if (warehouseId != null && warehouseId != '') {
            $(warehouseId).attr("disabled", true);
        }
        if (shopId != null && shopId != '') {
            $(shopId).attr("disabled", true);
        }
        if (cityId != null && cityId != '') {
            $(cityId).attr("disabled", true);
        }

        // 填写商家改变事件change的时候触发
        $(sellerNameId).change(function () {
            debugger;
            if ($(sellerNameId).val() == '') {
                ids = new Array();
                ids.push(deptId);
                ids.push(sellerIdId);

                if (warehouseId != null && warehouseId != '') {
                    ids.push(warehouseId);
                }
                if (shopId != null && shopId != '') {
                    ids.push(shopId);
                }
                iniSelect(ids);
            } else {
                $(deptId).attr("disabled", false);
                $(cityId).attr("disabled", false);
                $(deptId).html(getOptionHtml('user/getTenantId.do', $(sellerIdId).val(), true, "dept"));
                $(cityId).html(getOptionHtml('user/getTenantId.do', $(sellerIdId).val(), true, "city"));
                ids = new Array();

                if (warehouseId != null && warehouseId != '') {
                    ids.push(warehouseId);
                    iniSelect(ids);
                }
                if (shopId != null && shopId != '') {
                    ids.push(shopId);
                    iniSelect(ids);
                }
            }
        });
        // 填写事业部时当第二个change的时候触发
        $(deptId).change(function () {
            debugger;
            var options = $("#eventOrderAdd_deptartmentId option:selected");
            var deptId = options.val();
            var deptName= options.text();
            if (deptId == '') {
                ids = new Array();
                if (warehouseId != null && warehouseId != '') {
                    ids.push(warehouseId);
                    iniSelect(ids);
                }
                if (shopId != null && shopId != '') {
                    ids.push(shopId);
                    iniSelect(ids);
                }
            } else {
                if (warehouseId != null && warehouseId != '') {
                    $(warehouseId).attr("disabled", false);
                    $(warehouseId).html(getOptionHtml('user/getTenantId.do', deptId, true, "warehouse"));
                }
                if (shopId != null && shopId != '') {
                    $(shopId).attr("disabled", false);
                    $(shopId).html(getOptionHtml('user/getTenantId.do', deptId, true, "shop"));
                }
            }
        });
    }

    /**
     * 自动补全
     * @param id
     * @param url
     * @param query
     * @param sellerId    商家ID控件id
     * @param sellerName  商家名称控件id
     */
    function autoComplete(sellerNameId, url, query, sellerId) {
        debugger;
        var objectResults = []; //下拉列表数组
        var selected = false; //标记当前值是否由选中填充
        $.fn.typeahead.Constructor.prototype.blur = function () {
            var that = this;
            setTimeout(function () {
                that.hide()
            }, 250);
            var flag = false; //标记下拉列表数组是否包含当前输入值
            for (var object in objectResults) {
                if (objectResults[object] == $(sellerNameId).val()) {
                    flag = true;
                    break;
                }
            }
            if (!flag || !selected) {
                $(sellerId).val('').change();
                $(sellerNameId).val('').change();
                selected = false;
            }
        };

        $(sellerNameId).typeahead({
            source: function (query, process) {
                return $.getJSON(
                    url,
                    {
                        query: query,
                        sellerName: $(sellerNameId).val(),
                    },
                    function (data) {
                        objects = [];
                        map = {};
                        $.each(data, function (i, object) {
                            map[object.sellerName] = object;
                            objects.push(object.sellerName);
                        });
                        objectResults = objects;
                        return process(objects);
                    });
            },
            items: 10,
            updater: function (item) {
                $(sellerId).val(map[item].id).change();
                $(sellerNameId).val(map[item].sellerName).change();
                selected = true;
                return item;
            }
        });
    }
    /**
     * 清空下拉列表
     * @param ids
     */
    function iniSelect(ids) {
        for (var id in ids) {
            $(ids[id]).html("<option value=''>请选择</option>").change();
            $(ids[id]).attr("disabled", true);
        }
    }
    /**
     *
     * @param url 请求路径
     * @param value 上一级下拉id
     * @param head 是否显示"请选择"
     * @param type
     * @returns {String}
     */
    function getOptionHtml(url, value, head, type) {
        var html = "";
        if (head) {
            html = "<option value=''>请选择</option>";
        }
        if (value == '') {
            return html;
        }
        url = url + '?id=' + value+ '&type=' + type;

        $.ajax({
            url: url,
            async: false, //同步
            //data: param,
            dataType: 'json',
            success: function (res) {
                if (res.code != 200) {
                    return;
                }
                if (res.data != null) {
                    for (var i = 0; i < res.data.length; i++) {
                        var item = res.data[i];
                        html = html + "<option value=" + item.id + " errorDesc="+item.id+"-"+item.name+">" + item.name + "</option>";
                    }
                }

            }
        });
        return html;
    }
    //==================================================================================================================
    //==================================================================================================================
    //事件单导出
    $("#exportUserList").on("click",function () {
        bootbox.confirm("确定要导出吗?", function(result) {
            if(result) {
                $('#queryUserListInfoForm').attr('action', '/user/exportUserListPage'); //导出数据
                $('#queryUserListInfoForm').submit();
            }

        });
    });
    //==================================================================================================================
    //==================================================================================================================
    // $("#eventOrderRestitution").on("click", function () {
    //     $("#eventOrderRestitutionPanel").modal('show');
    // });
    /**
     * 转赔付事件
     */
    $("#leaveRestitutionSubmit").on("click", function () {
        submitRestitutionMsg(1);
    });
    $("#leaveRestitutionMCSSSubmit").on("click", function () {
        debugger;
        var jdv =  $("#restitution_jdvOrderNo").val();
        if (isEmpty(jdv)) {
            layer.msg("请您输入单号!", {icon: 5});
        }
        $("#restitution_content").val("赔付下发");
        $("#restitution_num").val(12);
        submitRestitutionMsg(2);
    });
    $("#leaveMsgSubmit").on("click", function () {
        $("#restitution_content").val("留言");
        $("#restitution_num").val(1);
        submitRestitutionMsg(3);
    });

    /**
     * 校验是否是数字
     * @param obj
     */
    function clearNoNum(obj){
        obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字而不是
        obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
    }
    function submitRestitutionMsg(orderFlowType){
        debugger;
        var chk_value =[];
        $('input[name="user_checkbox"]:checked').each(function(){
            chk_value.push($(this).val());
        });
        if (chk_value.length <=0) {
            $("#eventOrderRestitutionPanel").modal("hide");
            layer.msg("请选择需要赔付的信息", {icon: 5});
            return;
        }
        if (chk_value.length > 1) {
            $("#eventOrderRestitutionPanel").modal("hide");
            layer.msg("只能选择一条赔付的信息", {icon: 5});
            return;
        }
        var id = chk_value[0];
        var restitutionContent = $("#restitution_content").val();
        var restitutionNum = $("#restitution_num").val();
        if (isEmpty(restitutionContent) || restitutionContent.length > 490) {
            layer.msg("请您输入少于500字赔付原因!", {icon: 5});
            return;
        }
        if(isEmpty(restitutionNum)|| restitutionNum.length>10){
            layer.msg("赔付金额不能为空或者超过10位!", {icon: 5});
            return;
        }
        //组合restitutionContent
        restitutionContent = "赔付原因："+restitutionContent +"，&nbsp;&nbsp;&nbsp;赔付金额："+restitutionNum;
        $.ajax({
            "type": "post",
            "url":"user/submitComment",
            "dataType": "json",
            "data": {
                id:id,
                orderFlowType: orderFlowType,
                remark: restitutionContent
            },
            "success": function (data) {
                debugger;
                $("#eventOrderRestitutionPanel").modal('hide');
                if (data.code == 200) {
                    layer.msg(data.msg, {icon: 6});
                } else {
                    layer.msg(data.msg, {icon: 5});
                }
            },
            "error": function (data) {
                layer.msg("error系统未知异常,请刷新重试!", {icon: 5});
            }
        });
    };
    //==================================================================================================================
    //==================================================================================================================
    //评价下发
    $("#commentSubmit").on("click",function () {
        debugger;
        var chk_value =[];
        $('input[name="user_checkbox"]:checked').each(function(){
            chk_value.push($(this).val());
        });
        if (chk_value.length <=0) {
            $("#eventOrderSolvedStar").modal("hide");
            layer.msg("请选择需要评价的信息", {icon: 5});
            return;
        }
        if (chk_value.length > 1) {
            $("#eventOrderSolvedStar").modal("hide");
            layer.msg("只能选择一条评价的信息", {icon: 5});
            return;
        }
        var id = chk_value[0];
        var star_row1 = $("#eo-star-rating1").val();
        var star_row2 = $("#eo-star-rating2").val();
        var star_row3 = $("#eo-star-rating3").val();
        if(isEmpty(star_row1) || isEmpty(star_row2) || isEmpty(star_row3))  {
            layer.msg("请选择 时效/态度/质量 ", {icon: 5});
            return;
        }
        var otherToSay = $("#otherSay").val();
        var commonRet = star_row1 + "-"+star_row2 + "-"+star_row3;
        $.ajax({
            "type":"post",
            "url":"user/submitComment",
            "dataType":"json",
            "data":{
                id:id,
                orderFlowType: 5,
                comments:commonRet,
                remark:otherToSay
            },
            "success":function (data) {
                debugger;
                $("#eventOrderSolvedStar").modal("hide");
                if (data.code == 200) {
                    layer.msg(data.msg, {icon: 6});
                } else {
                    layer.msg(data.msg, {icon: 5});
                }
            },
            "error":function (data) {
                debugger;
                layer.msg("error系统未知异常,请刷新重试!", {icon: 5});
            }
        });
    });

    //==================================================================================================================
    //==================================================================================================================
    $("#eventOrderAdd_warehouse").on('click',function () {
        var errorDesc2 = $("#eventOrderAdd_warehouse option:selected").attr("errorDesc");
        $("#newEventOrderAdd_remark").val(errorDesc2);
        var warehouse = $("#eventOrderAdd_warehouse").val();
        if (null == warehouse || '' == warehouse) {
            return;
        }
        initBsicDataTagsFunction();
        showNewEventOrderBasicDataTags();
    });
    //==================================================================================================================
    //==================================================================================================================
    //测试接口
    $("#echo").on("click",function () {
        const param = {
            userName: "userName",
        };
        $.ajax({
            "type": "post",
            "url": "user/echo",
            "contentType" : 'application/json;charset=UTF-8',  //  后台用@RequestBody接收时  前端传参格式  contentType / JSON.stringify(param)
            "dataType": "json",
            "data": JSON.stringify(param),
            success: function (res) {
                if (res.code == 200) {
                    layer.msg(res.msg, {icon: 6});
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
            },
            error: function (res) {
                layer.msg("服务器异常", {icon: 5});
            }
        });
    });
    //==================================================================================================================
    //==================================================================================================================
    //so异常中心处理
    $("#soExceptionCentre").on("click",function () {
        jQuery.ajax({
            type: "post",
            url: "exceptionCentre/batchResumeException",
            data: {
                soExceptionNos: "CSL12345678,CSL6543244,CSL12345678",
                errType: "020",
                disposeType: 1,
                resumeReason:"重新下发"
            },
            dataType: "json",
            success: function (data) {
                debugger
                layer.msg(data.msg, {icon: 6});
            },
            error: function (data) {
                debugger
                layer.msg("系统异常", {icon: 5,time: 1500});
            }
        });
    });
    //==================================================================================================================
    //==================================================================================================================
    //新建异常单据
    $("#insertBillException").on("click",function () {
        jQuery.ajax({
            type: "post",
            url: "bill/insertBillException",
            data: {
                idAndbillTypes: "12144_3_4000",
                resumeReason:"新建异常单据"
            },
            dataType: "json",
            success: function (data) {
                debugger
                layer.msg(data.msg, {icon: 6});
            },
            error: function (data) {
                debugger
                layer.msg("系统异常", {icon: 5,time: 1500});
            }
        });
    });

    //异常单据处理
    $("#billException").on("click",function () {
        jQuery.ajax({
            type: "post",
            url: "bill/batchResumeException",
            data: {
                idAndbillTypes: "12144_3_4000",
                resumeReason:"重新下发"
            },
            dataType: "json",
            success: function (data) {
                debugger
                layer.msg(data.msg, {icon: 6});
            },
            error: function (data) {
                debugger
                layer.msg("系统异常", {icon: 5,time: 1500});
            }
        });
    });
    //==================================================================================================================
    //==================================================================================================================
    //初始化
    $("#initBsicDataTags").on("click",function () {
        initBsicDataTagsFunction();
    });

    var eo_baseInfoFields;
    //基本信息
    function initBsicDataTagsFunction() {
        debugger;
        //事业部
        $("#newEventOrderBasicDataHiddenDiv").append($("#newEventOrderAdd_DeptDiv"));
        $("#newEventOrderAdd_deptartmentId").removeClass("{required:true,messages:{required: '必选项'}}");
        $("#newEventOrderAdd_deptartmentId").val("");
        //店铺
        $("#newEventOrderBasicDataHiddenDiv").append($("#newEventOrderAdd_shopDiv"));
        $("#newEventOrderAdd_shopId").removeClass("{required:true,messages:{required: '必选项'}}");
        $("#newEventOrderAdd_shopId").val("");
        //仓库
        $("#newEventOrderBasicDataHiddenDiv").append($("#newEventOrderAdd_WarehouseDiv"));
        $("#newEventOrderAdd_warehouse").removeClass("{required:true,messages:{required: '必选项'}}");
        $("#newEventOrderAdd_warehouse").val("");
        //联系人
        $("#newEventOrderBasicDataHiddenDiv").append($("#newEventOrderAdd_LinkManDiv"));
        $("#newEventOrderAdd_linkMan").removeClass("{required:true,messages:{required: '必填项'}}");
        $("#newEventOrderAdd_linkMan").val("");
        //联系电话
        $("#newEventOrderBasicDataHiddenDiv").append($("#newEventOrderAdd_TelDiv"));
        $("#newEventOrderAdd_tel").removeClass("{required:true,isPhone:true,messages:{required: '必填项',isPhone:'手机格式不正确'}}");
        $("#newEventOrderAdd_tel").val("");

        //删除带有临时标记的标签
        $(".eo_temp_tr").remove();
    }
    //显示自定义的基本信息项
    function showNewEventOrderBasicDataTags() {
        debugger;
        eo_baseInfoFields = ["3", "1", "5", "2"];
        var hasDept = false;
        for (var e in eo_baseInfoFields) {
            if (eo_baseInfoFields[e] == "1") {
                hasDept = true;
                break;
            }
        }
        if (!hasDept) {
            eo_baseInfoFields.push("1");
        }
        eo_baseInfoFields.sort();
        var eo_baseInfoFields_temp = [];
        for (var eo in eo_baseInfoFields) {  //遍历数组
            eo_baseInfoFields_temp.push(eo_baseInfoFields[eo]);
            if (eo_baseInfoFields[eo] == "1") {
                eo_baseInfoFields_temp.push("9");
            }
         }
        eo_baseInfoFields = eo_baseInfoFields_temp;

        var len = eo_baseInfoFields.length;
        var trCount = Math.ceil(len/2);
        var temp = 0 ;
        for(var i = 0; i < trCount; i++){
            var tr = $("<tr>");
            tr.addClass("eo_temp_tr");
            for(var j = 0; j < 2; j++){
                var td = $("<td>");
                var tag = eo_baseInfoFields[temp];
                if(tag == "3"){
                    $("#newEventOrderAdd_warehouse").addClass("{required:true,messages:{required: '必选项'}}");
                    td.append($("#newEventOrderAdd_WarehouseDiv"));
                }
                if(tag == "2"){
                    $("#newEventOrderAdd_tel").addClass("{required:true,isPhone:true,messages:{required: '必填项',isPhone:'手机格式不正确'}}");
                    td.append($("#newEventOrderAdd_TelDiv"));
                }
                if(tag == "5"){
                    $("#newEventOrderAdd_linkMan").addClass("{required:true,messages:{required: '必填项'}}");
                    td.append($("#newEventOrderAdd_LinkManDiv"));
                }
                if(tag == "1"){
                    $("#newEventOrderAdd_deptartmentId").addClass("{required:true,messages:{required: '必选项'}}");
                    td.append($("#newEventOrderAdd_DeptDiv"));
                }
                if(tag == "9"){
                    $("#newEventOrderAdd_shopId").addClass("{required:true,messages:{required: '必填项'}}");
                    td.append($("#newEventOrderAdd_shopDiv"));
                }
                tr.append(td);
                temp++;
                if(temp >= len){
                    break;
                }
            }
            $("#getOrderInfo_flag").before(tr);

        }
    }
    //==================================================================================================================
    //==================================================================================================================
    /**
     * 添加信息绑定的单击事件
     */
    $("#addEventOrderBtn").bind('click', function () {
        debugger;
        if ($('#queryUserListInfoForm').valid()) {

            jQuery(this).button('loading');

            saveEventOrderInfo();
        }
    });
    function saveEventOrderInfo() {
        debugger;
        var fileListJson = [];
        $("#submit_file_list_file input[type='hidden']").each(function () { //获取div里面input 为hidden的值 循环
            fileListJson.push({fileStr: $(this).val()}); // fileStr对象 加入数组
        });

        $("#submit_image_list_image input[type='hidden']").each(function () {
            fileListJson.push({fileStr: $(this).val()});
        });

        var userName = $("#userName").val();
        var password = $("#password").val();
        var phone = $("#phone").val();

        jQuery.ajax({
                type: "post",
                url: "user/register",
            data: {
                userName: userName,
                password: password,
                fileListJson: JSON.stringify(fileListJson),
                phone:phone
            },
            dataType: "json",
            success: function (data) {
                debugger
                jQuery("#addEventOrderBtn").button("reset");
                layer.msg(data.msg, {icon: 6});
            },
            error: function (data) {
                debugger
                layer.msg("系统异常", {icon: 5,time: 1500});
                jQuery("#addEventOrderBtn").button("reset");
            }
        });
    }

    //==================================================================================================================
    //==================================================================================================================
    //定时任务 每3秒执行一次  获取当前时间  并且去掉遮罩层
    var myVar = setInterval(function(){ myTimer() }, 2000);

    function myTimer() {
        //$('.modal-backdrop').remove();
        var date = new Date();
        var localTime = date.toLocaleTimeString();
        //document.getElementById("demo").innerHTML = t;
        $("#demo").html(localTime);
        //window.clearTimeout(myVar);//去掉定时器
    }





    //==================================================================================================================
    //==================================================================================================================
    /**
     * dataTable 设置td的title
     */
    jQuery.fn.setDataTableTdTitle=function(){
        var params = arguments;
        jQuery(this).find('tbody tr').each( function() {
            var nTds = jQuery('td',this);
            for(var index=0;index< params.length;index++){
                var displayColumn = params[index];
                var title =  jQuery(nTds[displayColumn]).text() ;
                jQuery(nTds[displayColumn]).attr("title",title) ;
            }
        } );
    };
//列表展示 分页
var userList_grid;
    eventOrder={
        loadEventOrder:function () {
            userList_grid = $('#userList_query-table')
                .dataTable(
                    {
                        "aoColumns": [
                            {"sDefaultContent": '', "bSortable": false, "sTitle": "操作", "sClass": "center"},
                            {"sDefaultContent": '', "bSortable": false, "sTitle": "选择", "sClass": "center"},
                            {"sDefaultContent": '', "bSortable": false, "sTitle": "<input id ='billExceptionCentreCheckAll' name='' type='checkbox'/>","sClass": "center", "sWidth": "5%"},
                            {"sDefaultContent": '', "bSortable": false, "sTitle": "商品价值", "sClass": "center"},
                            {"mData": "id", "sTitle": "编码", "bSortable": false, "sClass": "center"},
                            {"mData": "userName", "sTitle": "用户名", "bSortable": true, "sClass": "center"},
                            {"mData": "password", "sTitle": "密码", "bSortable": false, "sClass": "center"},
                            {"mData": "sexStr", "sTitle": "性别", "bSortable": false, "sClass": "center"},
                            /*不展示直接注释 不然有问题{"mData": "salt", "sTitle": "加盐", "bSortable": false, "sClass": "center", "visible": false},*/
                            {"mData": "salt", "sTitle": "加盐", "bSortable": false, "sClass": "center"},
                            {"mData": "createTimeStr", "sTitle": "创建时间", "bSortable": true, "sClass": "center"},
                            {
                                "mData": "id",
                                "sTitle": "订单编号",
                                "sClass": "center",
                                "mRender": function(data, type, full) {
                                    var sReturn =
                                        '<a href="javascript:;" title="点击查看订单详情" class="btn btn-sm btn-default" onclick="javascript:goToSoDetail(' +full.id + ',\''+full.userName+'\')">' + full.id + '</a>';
                                    return sReturn;
                                }
                            },
                            {
                                "mData": "",
                                "bSortable": false,
                                "sTitle": "操作",
                                "sClass": "center",
                                "sWidth": "20px",
                                "mRender": function(data, type, full) {
                                    var exceptionCodeFlag = "302-";
                                    var billType = 1;
                                    var exceptionCode = null;
                                    var sReturn =
                                        "<a onclick='goToBillExceptionResume(\"" + full.id + "\",\"" + full.createTime + "\",\"" +exceptionCodeFlag+ "\",\""+
                                        full.id+'_'+billType+ '_'+exceptionCode+ '_'+exceptionCodeFlag + '_'+full.id
                                        +"\")' href=\"javascript:void(0);\">处理</a>";

                                    return sReturn;
                                }

                            }

                        ],
                        "bPaginate": true, //是否分页
                        "bFilter": false,//是否启用客户端过滤功能
                        "bProcessing": true, //当datatable获取数据时候是否显示正在处理提示信息。
                        "bLengthChange": true,//改变每e页显示数据数量
                        "iDisplayLength": 10,
                        //"bProcessing": false,
                        "bServerSide": true,
                        "bSort": true,//是否使用排序
                        "aaSorting": [
                            [9, "desc"]
                        ],
                        "fnCreatedRow": function (nRow, aData, iDisplayIndex) {
                            debugger;
                            var id     = aData.id;
                            var sex     = aData.sex;
                            var password     = aData.password;
                            var salt     = aData.salt;
                            var userNum     = "";
                            //操作列重写
                            var menu = [];
                            menu.push("<div class='btn-group'>");
                            menu.push("<button id='btnEoDetail' name='btnEoDetail' onclick='cancelRedPoint(" + id + "),findDetail(" + id + ")' type=\"button\" class=\"btn btn-primary btn-xs\">查看</button>");
                            menu.push("<button type=\"button\" class=\"btn btn-primary dropdown-toggle btn-xs\" data-toggle=\"dropdown\"><span class=\"caret\"></span></button>");
                            menu.push("<ul class=\"dropdown-menu\" role=\"menu\">");
                            menu.push("<li><a  class=\"btn btn-primary\" onclick='deleteUser("+id+")'>删除</a></li>");
                            if( id == 1){
                                menu.push("<li><a  class=\"btn btn-primary\" onclick='downEo("+id+")'>下发</a></li>");
                            }
                            menu.push("</ul>");
                            menu.push("</div>");
                            $('td:eq(0)', nRow).html(menu.join('')).attr("style", "overflow:visible");
                            var spanFlag = [];
                            var sexStrArray = [];
                            var statusNameArray = [];
                            var checkboxArray = [];
                            var inputArray = [];
                            var billboxArray = [];
                            //复选框
                            var elemCheckbox = '<input type="checkbox" name="user_checkbox" value='+ id +'>';
                            checkboxArray.push(elemCheckbox);
                            $('td:eq(1)', nRow).html(checkboxArray.join(''));

                            //jQuery('td:eq(2)', nRow).html('<input value="' + aData.id+'_'+aData.billType+ '_'+aData.exceptionCode+ '_'+aData.exceptionCodeFlag + '_'+aData.billNo +'"  name="billExceptionCentreCheck" type="checkbox" />');
                            /*var billCheckbox = '<input value="10_1_302_2051-_YC0001"  name="billExceptionCentreCheck" type="checkbox" />';
                            billboxArray.push(billCheckbox);
                            $('td:eq(2)', nRow).html(billboxArray.join(''));*/

                            jQuery('td:eq(2)', nRow).html('<input value="10_1_302_302_YC0001"  name="billExceptionCentreCheck" type="checkbox" />');


                            var input = "<input class='chkClass' type='text'  width='35px'  value = "+userNum+"> <input class='chkClassId' type='hidden'  value = "+id+">";
                            inputArray.push(input);
                            $('td:eq(3)', nRow).html(inputArray.join(''));

                            /*未读加红点标识*/
                            if(id == 1){
                                var eleEoNo = '<div id=\"eonoNo_'+ id +'\"><span class="red-point">'+id+'</span></div>';
                                spanFlag.push(eleEoNo);
                            }else {
                                var elemEoNo = '<div id=\"eonoNo_'+ id +'\">'+ id + '</div>';
                                spanFlag.push(elemEoNo);
                            }

                            $('td:eq(4)', nRow).html(spanFlag.join(''));

                            jQuery('td:eq(5)', nRow).html("<button  class='btn btn-link Detail' value='" + id + "' style='padding: 0' alias='"+aData.createTime+"' >" + aData.userName + "</button>");
                            //由于界面定时任务需要根据创建人定时刷新当前未读事件单信息部分字段 fanhong1
                            // var elemStatusName = '<div id=\"userSex_'+ id +'\">'+ status + '</div>';
                            // statusNameArray.push(elemStatusName);
                            // $('td:eq(5)', nRow).html(statusNameArray.join(''));
                            jQuery('td:eq(6)', nRow).html(_choseStatus(id, password));

                            if (sex == 1) {
                                $('td:eq(7)', nRow).html('男');
                            } else {
                                $('td:eq(7)', nRow).html('女');
                            }
                             //解析错误信息
                            if(salt!=''&&salt!='null'&&salt!=null){
                                jQuery('td:eq(8)', nRow).html("<div class='errorMsgCla' onmouseover='overShow(this,event)'  style='width:150px;overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>" + salt + "</div><div id='showDiv' style='background-color: white; border: 1px solid black;position: absolute;  max-height: 350px;z-index: 10; box-shadow:0px 0px 10px #000;display: none;white-space: pre-line;max-width: 700px;'  onmouseout='outHidden(event)' ></div>");
                            }

                            return nRow;
                        },
                        "sAjaxSource": "/user/findUserListPage?rand=" + Math.random(),
                        "fnServerData": eventOrder.retrieveUserListData,
                        "fnDrawCallback":function(){
                            $('#userList_query-table').setDataTableTdTitle(2);
                        }
                    });

            $("#queryUserList").on("click" ,function () {
                userList_grid.fnDraw();
            });
        },

        /*** 异步加载数据 **/
        retrieveUserListData:function(sSource, aoData,fnCallback) {
            jQuery.ajax({
                "type" : "post",
                "url" : sSource,
                "dataType" : "json",
                "data" : {
                    password:$("#password").val(),
                    userName:$("#userName").val(),
                    createTimeStart:$("#eventOrderList_createTimeStart").val(),
                    createTimeEnd:$("#eventOrderList_createTimeEnd").val(),
                    aoData : JSON.stringify(aoData)
                }, // 以json格式传递
                "success" : function(resp) {
                    fnCallback(resp);
                    $('.Detail').bind("click", function () {
                        openDetailPage(this.value,$(this).attr("alias"));
                    });
                    addKeyUp();
                }
            });
        }

    };


    /***查看页面**/
    function openDetailPage(id,createTime) {
        alert(id);
        alert(createTime);
        findDetail(id);
    }

    //==================================================================================================================
    //==================================================================================================================
    function _choseStatus(id, arg) {
        debugger;
        switch (id) {
            //label-default
            case  1:
            case 2:
                return "<label class='label label-default'>" + arg + "</label>";
                break;
            //label-primary
            case  3:
            case 4:
                return "<label class='label label-primary'>" + arg + "</label>";
                break;
            //label-success
            case 5:
                return "<label class='label label-success'>" + arg + "</label>";
                break;
            //label-info
            case 6:
                return "<label class='label label-info'>" + arg + "</label>";
                break;
            //label-warning
            case 7:
                return "<label class='label label-warning'>" + arg + "</label>";
                break;
            //label-danger
            case 8:
                return "<label class='label label-danger'>" + arg + "</label>";
                break;
            default :
                return  arg;
        }
    }
    //==================================================================================================================
    //==================================================================================================================
    //去掉红点
    function cancelRedPoint(id){
        debugger;
        var redthis = "#eonoNo_"+id;
        if( ($( redthis+":has(span)" ).length > 0) || $(redthis).children("span").hasClass("red-point")){
            $(redthis).children("span").removeClass("red-point");
        }
        $("#eonoNo_"+id).children().removeClass("red-point");
    }

    function findDetail(id){
        window.open("/gotoUserDetailPage?id="+ id,'top');
        // window.location.href = "/gotoUserDetailPage?id="+ id;
    }
    //==================================================================================================================
    //==================================================================================================================
    //下发
    function downEo(id) {
        bootbox.confirm("确定要下发单据CWO"+id+"吗?", function (result) {
            if (result) {
                jQuery.ajax({
                    type: "get",
                    url: "user/getById",
                    data: {id: id},
                    dataType: "json",
                    success: function (data) {
                        layer.msg(data.id+"下发成功", {icon: 6});
                        userList_grid.fnDraw(); //重新加载数据
                    }
                });
            }
        });
    }
    //==================================================================================================================
    //==================================================================================================================
    //删除
    function deleteUser(id) {
        bootbox.confirm("确定要删除"+id+"吗?", function (result) {
            if (result) {
                jQuery.ajax({
                    type: "POST",
                    url: "user/deleteUser",
                    data: {id: id},
                    dataType: "json",
                    success: function (data) {
                        layer.msg(data.msg, {icon: 6,time:1000})
                        userList_grid.fnDraw(); //重新加载数据
                    },
                    error: function (data) {
                        layer.msg("服务器异常", {icon: 5});
                        userList_grid.fnDraw(); //重新加载数据
                    }
                });
            }
        });
    }
    //==================================================================================================================
    //==================================================================================================================
    //跳转附件上传页面
    $("#upload").on("click",function () {
        window.location.href = "/toUpload";
    });

    function uploadFile(){
        debugger;
        var fileIndex = 0;
        $('#myModalFileUpload').on('hidden.bs.modal', function (e) {
            var fileList = $("#myModalFileUpload").find("iframe")[0].contentWindow.document.getElementsByName("fileObject");
            for (var i = 0; i < fileList.length; i++) {
                var file = fileList[i].value;
                var obj = file.split(",");
                var objectId = "del_tag_" + getUUID();
                if (obj[3] == 1) {
                    var hiddenFile = "<input id='" + objectId + "' type='hidden' name='eventOrderFileList[" + fileIndex + "].fileStr' value='" + file + "' />";
                    var delBtn = "<button onclick='deleteFile(\"" + obj[1] + "\",\"" + objectId + "\")'>删除</button> &nbsp;&nbsp;</span>";
                    var aStart = "<a  target='_blank'  href='" + obj[1] + "' title='" + obj[0] + "'>";
                    var aEnd = "</a>";
                    var images = "<span id='" + objectId + "'>" + aStart + "<img src='" + obj[4] + "' alt='"+obj[0] +"' width='60px' height='60px'/>" + aEnd + delBtn;
                    $("#image_list").append(images);
                    $("#submit_image_list_image").append(hiddenFile);
                } else {
                    var hiddenFile = "<input id='" + objectId + "' type='hidden' name='eventOrderFileList[" + fileIndex + "].fileStr' value='" + file + "' />";
                    var delBtn = "<button onclick='deleteFile(\"" + obj[1] + "\",\"" + objectId + "\")'>删除</button></li>";
                    var li = "<li style='width: 500px;;' id='" + objectId + "'><a  target='_blank' href='" + obj[1] + "'>" + obj[0] + "</a>" + delBtn;
                    $("#file_list").append(li);
                    $("#submit_file_list_file").append(hiddenFile);
                }
                fileIndex++;
            }
            //刷新上传页面
            $("#myModalFileUpload").find("iframe")[0].contentWindow.document.location.reload();

        });
    }


    //业务标识联动入库类型
    //==================================================================================================================
    //==================================================================================================================
    $("#businessSign").change(function () {
        debugger;
        var receiptsPerformType = $("#receiptsPerformType");
        receiptsPerformType.empty();
        receiptsPerformType.append('<option value="">---请选择---</option>');
        $("#receiptsPerformType").attr("disabled", false);

        var options = $("#businessSign option:selected").val();
        if ( options == null || options == '') {
            $("#receiptsPerformType").attr("disabled", true);
            return;
        }
        const param = {
            enumType: "ReceiptsPerformTypeEnum",
        };
        $.ajax({
            "type": "post",
            "url": "enum/queryEnum",
            "contentType" : 'application/json;charset=UTF-8',  //  后台用@RequestBody接收时  前端传参格式  contentType / JSON.stringify(param)
            "dataType": "json",
            "data": JSON.stringify(param),
            success: function (res) {
                if (res.code == 200) {
                    const receiptsPerformType = $("#receiptsPerformType");
                    receiptsPerformType.empty();
                    let str = '<option value="">---请选择---</option>';
                    for (const o in res.data) {
                        str += '<option value="' + res.data[o].code + '">' + res.data[o].name + '</option>';
                    }
                    receiptsPerformType.append(str)
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
            },
            error: function (res) {
                layer.msg("服务器异常", {icon: 5});
            }
        });
    });



    //单据号获取信息 页面动态展示数据
    //==================================================================================================================
    //==================================================================================================================
    $("#newEventOrderAdd_bizOrderNo").on("blur", function () {
        debugger;
        const bizOrderNo = $("#newEventOrderAdd_bizOrderNo").val().trim();//业务单号
        var bizType = $("#newEventOrderAdd_bizType").val();//单据类型
        if(bizOrderNo == "") {
            return;
        }
        var param = {
            bizOrderNo: bizOrderNo,
            bizType: bizType
        };
        getOrderInfo(param, 1);
    });


    /**
     * 获取订单详情
     * @param orderNo
     */
    function getOrderInfo(param, type) {
        jQuery.ajax({
            type: "post",
            url: "user/getOrderInfo",
            data: param,
            dataType: "json",
            success: function (data) {
                debugger;
                if (data.code == 200) {
                    //layer.msg("SUCCESS", {icon: 6});
                    if (type == 1) {
                        //动态展示 根据单号事件
                        debugger;
                        var deptId = data.data.deptId;
                        var shopId = data.data.shopId;
                        var shopFlag = data.data.shopFlag;
                        var deptFlag = data.data.deptFlag;
                        var bizOrderNo = $("#newEventOrderAdd_bizOrderNo").val();
                        getDeptAndShopInfo();
                        validateDeptAndShop(deptId, shopId, shopFlag, deptFlag);
                    }

                } else {
                    $("#newEventOrderAdd_bizOrderNo").val("");
                    layer.msg("查询失败", {icon: 5});
                }
            },
            error: function (data) {
                $("#newEventOrderAdd_bizOrderNo").val("");
                layer.msg("输入单号不存在，请核对正确后重新输入！", {icon: 5});
            }
        });

    }


    function getDeptAndShopInfo() {
        debugger;
        initBsicDataTagsFunction();
        var bizType = "9";
        if(bizType == "9"){//SKU 显示基础信息项：事业部、仓库
            var tr = $("<tr>");
            var tr1 = $("<tr>");
            tr.addClass("eo_temp_tr");
            tr1.addClass("eo_temp_tr");
            var td1 = $("<td>");
            var td2 = $("<td>");
            var td3 = $("<td>");
            $("#newEventOrderAdd_deptartmentId").addClass("{required:true,messages:{required: '必选项'}}");
            td1.append($("#newEventOrderAdd_DeptDiv"));
            $("#newEventOrderAdd_shopId").addClass("{required:true,messages:{required: '必选项'}}");
            td2.append($("#newEventOrderAdd_shopDiv"));
            $("#newEventOrderAdd_warehouse").addClass("{required:true,messages:{required: '必选项'}}");
            td3.append($("#newEventOrderAdd_WarehouseDiv"));
            tr.append(td1);
            tr.append(td2);
            tr1.append(td3);
            $("#getOrderInfo_flag").before(tr);
            $("#getOrderInfo_flag").before(tr1);
            return;
        }
        if($("#newEventOrderAdd_bizType").val() == "12"){//出库单号 不显示基础信息项
            var tr = $("<tr>");
            tr.addClass("eo_temp_tr");
            var td1 = $("<td>");
            $("#newEventOrderAdd_deptartmentId").addClass("{required:true,messages:{required: '必选项'}}");
            td1.append($("#newEventOrderAdd_DeptDiv"));
            tr.append(td1);
            $("#getOrderInfo_flag").before(tr);
            return;
        }
        showNewEventOrderBasicDataTags();
    }


    function validateDeptAndShop (deptId, shopId, shopFlag, deptFlag) {
        debugger;
        if (deptFlag == "1") {
            var deptPoObj = document.getElementById("newEventOrderAdd_deptartmentId");
            for(var i=0; i<deptPoObj.options.length; i++) {
                var values = deptPoObj.options[i].value;
                if (deptPoObj.options[i].value == deptId) {
                    deptPoObj.options[i].selected = true;
                    $("#newEventOrderAdd_deptartmentId").val([values]).select2(); //select2 显示默认值设置
                    $("#newEventOrderAdd_deptartmentId").attr("disabled", true);
                    break;
                }
            }
            var options = $("#newEventOrderAdd_deptartmentId option:selected");
            var value = options.val();
            var text = options.text();
            loadShop();

            if (shopFlag == "1") {
                var shopPoObj = document.getElementById("newEventOrderAdd_shopId");
                for(var i=0; i<shopPoObj.options.length; i++) {
                    var a = shopPoObj.options[i].value;
                    if (shopPoObj.options[i].value == shopId) {
                        shopPoObj.options[i].selected = true;
                        $("#newEventOrderAdd_shopId").attr("disabled", true);
                        break;
                    }
                }
            }

        }

    }


    //根据事业部联动出店铺
    //==================================================================================================================
    //==================================================================================================================

    $("#newEventOrderAdd_deptartmentId").on('change',function () {
        debugger;
        var deptId = $("#newEventOrderAdd_deptartmentId").val();
        if(deptId == ""){
            var shopSelect = $("#newEventOrderAdd_shopId");
            shopSelect.empty();
            shopSelect.append('<option value="">请选择</option>');
        } else {
            loadShop();
        }
    });

    function loadShop() {
        debugger;
        var departmentId = $("#newEventOrderAdd_deptartmentId").val();
        var soInfo_shop = $("#newEventOrderAdd_shopId");
        soInfo_shop.empty();
        soInfo_shop.append('<option value="">请选择</option>');
        $.ajax({
            "type": "post",
            "url": "test/getShopByDeptId.do",
            "dataType": "json",
            async: false,
            "data": {
                deptId: departmentId
            },
            success: function (data) {
                debugger;
                var soInfo_shop = $("#newEventOrderAdd_shopId");
                soInfo_shop.empty();
                var str = '<option value="">--请选择--</option>';
                for (var i = 0; i < data.length; i++) {
                    var item = data[i];
                    str += '<option value="' + item.id + '">' + item.shopName + '</option>';
                }
                soInfo_shop.append(str)
            }
        });
    }

    //==================================================================================================================
    //==================================================================================================================
    /*标记已经进行编辑过*/
    function addKeyUp() {
        console.log("sbsbsbsbsbsb")
        $(".chkClass").on('keyup', function () {
            console.log('.on(keyup) = ' + $(this).val());
            $("#exchangeFlag").val("1");
        });
    }

    /**保存功能 表单提交* */
    $("#mergeItem-form-sumbit").on('click', (function () {
        debugger;
        $("#mergeItem-form-sumbit").attr({"disabled": "disabled"});
        var ar = Array();
        var goods = "[";
        var result = false;
        var hasZero = false;
        if ($("#userList_query-table tbody tr").length == 0) {
            layer.msg("请添加要生成的商品信息！", {icon: 5});
            $("#mergeItem-form-sumbit").removeAttr("disabled");
            return false;
        }
        $("#userList_query-table tbody tr").each(function () {
            debugger;
            var gNum = $(this).children('td').eq(2).find(".chkClass").val();
            var rowIndex = $(this).parents("tr").index();
            //此处拿到隐藏列的id
            // debugger;

            var id = $(this).children('td').eq(2).find(".chkClassId").val();
            var userName = $(this).children('td').eq(2).find(".chkClassId").val();

            if(gNum == null || gNum == '' || gNum == 0){
                $(this).children('td').eq(2).find(".chkClass").val(0);
                goods += "{\"id\":" +id + ",\"userName\":\""+userName+"\",\"userNum\":" + 0 +"},";
                hasZero = true;
            }else{
                if (!/(^[1-9]\d{0,7}(\.\d{1,2})?$)|(^[0](\.\d{1,2})?$)/.test(gNum) || gNum < 0) {
                    layer.msg("姓名：" + $(this).children('td').eq(3).text() + "的商品价值不正确，请输入一个合法金额！", {icon: 5});
                    result = true;
                }else {
                    goods += "{\"id\":" +id + ",\"userName\":\""+userName+"\",\"userNum\":" + gNum +"},";
                }
            }
        });
        if (result) {
            $("#mergeItem-form-sumbit").removeAttr("disabled");
            return false;
        }
        goods = goods.substring(0, goods.length - 1);
        goods += "]";
        if($("#exchangeFlag").val() == "1"){
            if(hasZero){
                bootbox.confirm("明细中存在未维护价值的SKU,系统将按‘0’处理，您确认提交吗?", function(result) {
                    $("#mergeItem-form-sumbit").removeAttr("disabled");
                    if(result) {
                        submitEditItem();
                    }});
            }else {
                submitEditItem()
            }
        }else{
            var msg = "您还未做更改，确认提交吗?";
            if(hasZero){
                msg = "您还未做更改,明细中存在未维护价值的SKU,系统将按‘0’处理，确认提交吗?"
            }
            bootbox.confirm(msg, function(result) {
                $("#mergeItem-form-sumbit").removeAttr("disabled");
                if(result) {
                    submitEditItem();
                }});
        }

        function submitEditItem() {
            jQuery.ajax({
                type: "post",
                url: "user/editItem",
                data: {
                    items: goods,
                    compensateWay:$("#compensateWay").val()
                },
                dataType: "json",
                success: function (data) {
                    if (data.code == 200) {
                        layer.msg(data.msg, {icon: 6});
                    }else {
                        layer.msg(data.msg, {icon: 5});
                    }
                },
               error: function (XMLHttpRequest, textStatus, errorThrown) {
                   $("#poMain-form-sumbit").removeAttr("disabled");
                   layer.msg("系统异常!!!", {icon: 5});
               }
            });
        }
    }));

    //==================================================================================================================
    //==================================================================================================================
    //批量处理
    function getCheckbox() {
        $("#billExceptionCentreCheckAll").on('click', (function () {
            debugger;
            if($('#billExceptionCentreCheckAll').is(':checked')==true){
                $("input[name='billExceptionCentreCheck']").each(function() {
                    this.checked = true;
                });
            }else{
                $("input[name='billExceptionCentreCheck']").each(function() {
                    this.checked = false;
                });
            }
        }));
    }
    /*** 批量恢复 **/
    function resumeBillExceptionCentre () {
        $("#resumeBillExceptionCentreForm").on('click', (function () {
            var idAndbillTypes="";
            var soExceptionNos="";
            var msg={"type":true};
            var exceptionCodeFlag = "";
            $('input[name="billExceptionCentreCheck"]:checked').each(function (i, d) {
                var idAndType=d.value;
                if (idAndType!=null&&idAndType!='') {
                    var arr= idAndType.split("_");
                    var exceptionCode=arr[2];
                    if (exceptionCode=='400') {
                        msg.type=false;
                        layer.msg("暂不支持处理该类型异常!", {icon: 5});
                    }
                    if (exceptionCodeFlag == ""){
                        exceptionCodeFlag = arr[3];
                    } else if (exceptionCodeFlag != arr[3]){
                        layer.msg("只支持同类型异常批量处理,建议选择异常类型，查询后再进行选择", {icon: 5});
                        return;
                    }
                    soExceptionNos += arr[4] + ",";
                    idAndbillTypes += arr[0] + "_" + arr[1] + "_" + arr[2] + ",";
                }
            });

            if(idAndbillTypes.length==0){
                layer.msg("至少选择一个异常订单恢复!", {icon: 5});
                return;

            }
            debugger
            if(soExceptionNos.indexOf(",") != -1) {
                soExceptionNos = soExceptionNos.substr(0, soExceptionNos.length - 1)
            }
            var errType = exceptionCodeFlag;
            jQuery.post(
                "/exceptionCentre/getProcessBtn",
                {errType: errType },
                function (result1) {
                    if(result1.success){
                        debugger
                        var BillExceptionProcessBtn = new BillExceptionListProcessBtn();
                        bootbox.dialog({
                            title: "请选择异常处理方式",
                            message:BillExceptionProcessBtn.getInstance(result1.data).outerHTML,
                            buttons: {
                                confirm: {
                                    label: '确定',
                                    className: 'btn-primary',
                                    callback: function() {
                                        var disposeType = $('input[name="batchResumeRadio"]:checked').val();
                                        if(disposeType == null){
                                            layer.msg("请选择一个处理方式", {icon: 5});
                                        }else {
                                            debugger;
                                            var data={};
                                            data["soExceptionNos"]=soExceptionNos;
                                            data["errType"]=exceptionCodeFlag;
                                            data["resumeReason"]=$("#batchResumeErrReason").val();
                                            data["disposeType"]=disposeType;
                                            $.ajax({
                                                url: "/exceptionCentre/batchResumeException",
                                                type: "post",
                                                data: data,
                                                dataType: "json",
                                                success: function (result) {
                                                    layer.msg(result.msg, {icon: 6});
                                                    return;
                                                },
                                                error: function () {
                                                    layer.msg("失败!", {icon: 5});
                                                    return;
                                                }
                                            });
                                        }
                                    }
                                },
                                cancel: {
                                    label: '取消',
                                    className: 'btn-default',
                                    callback: function() {
                                        return;
                                    }
                                }
                            }
                        });
                    }
            });
        }));
    }

    var BillExceptionListProcessBtn = function() {
        debugger;
        var __self__;
        BillExceptionListProcessBtn.prototype.getInstance = function(full) {
            debugger
            __init__(full);
            return __self__;
        };
        function __init__(full) {
            debugger
            __self__ = document.createElement("div");
            $(__self__).html("");
            if (typeof(full) != "undefined" && full != null) {
                var processBtn = $.parseJSON(full);
                var __label__ = document.createElement("label");
                $(__label__).html(processBtn.errOperate);
                $(__self__).append(__label__);
                if (processBtn.errDisposes.length > 0) {
                    for (i in processBtn.errDisposes) {
                        $(__self__).append(__createLi__(processBtn.errDisposes[i], processBtn.admin));
                    }
                    $(__self__).append("</label><textarea id='batchResumeErrReason' class='form-control' rows='3' placeholder='请输入恢复原因'></textarea></div>");

                }
            } else {
                var __label__ = document.createElement("label");
                $(__label__).html("暂不支持处理");
                $(__self__).append(__label__);
            }
        }
        function __createLi__(errDis,  auth) {
            debugger
            var errDispose = $.parseJSON(errDis);
            var _div_ = document.createElement("div");
            $(_div_).addClass("radio");
            var _input_= document.createElement("input");
            $(_input_).attr("type","radio");
            $(_input_).attr("name","batchResumeRadio");
            $(_input_).attr("value",errDispose.type);
            if(!auth){
                $(_input_).attr("disabled",true);
                $(_div_).attr("data-toggle","tooltip");
                $(_div_).attr("data-placement","top");
                $(_div_).attr("title","无权限");
                $(_div_).css("opacity", "0.2");
            }else if(!errDispose.batch){
                $(_input_).attr("disabled",true);
                $(_div_).attr("data-toggle","tooltip");
                $(_div_).attr("data-placement","top");
                $(_div_).attr("title","不支持批量处理");
                $(_div_).css("opacity", "0.2");
            }
            var _label_= document.createElement("label");
            $(_label_).append(_input_);
            $(_label_).append(errDispose.name+"-"+errDispose.tipMsg);
            $(_div_).append(_label_);
            return _div_;
        }
    };
    //==================================================================================================================
    //==================================================================================================================

    /***查看页面**/
    function goToSoDetail(value,createTime) {
        layer.msg(value+createTime, {icon: 6});
    }
    //==================================================================================================================
    //==================================================================================================================
    function goToBillExceptionResume(id,createTime,exceptionCodeFlag,str) {
        debugger;
        if (exceptionCodeFlag.endsWith(soExceptionTypeFlag)){
            window.open("/exceptionCentre/gotoSoExceptionDetail?id="+ id,'top');
        } /*else {
            var idAndbillTypes;
            var arr= id.split("_");
            idAndbillTypes = arr[0] + "_" + arr[1] + "_" + arr[2];

            if (arr[2] == 400) {
                $.clps.msgAlert("error","暂不支持处理该类型异常");
                return;
            }

            var data = {};
            data["idAndbillTypes"] = idAndbillTypes;
            //data["resumeReason"] = $("#batchResumeErrReason").val();
            $.ajax({
                url: "billexception/batchResumeException.do?rand=" + Math.random(),
                type: "post",
                data: data,
                dataType: "json",
                success: function (result) {
                    bootbox.alert(result.tipMsg + "", function () {
                        if (result.success) {
                            billexecption_grid.fnDraw();
                        }
                    });

                },
                error: function () {
                    bootbox.alert("操作失败");

                }
            });

        }*/

    }

    //==================================================================================================================
    //==================================================================================================================

    function overShow(obj,e) {
        var showDiv = document.getElementById('showDiv');
        var theEvent =  e;
        showDiv.style.left = theEvent.clientX+"px";
        showDiv.style.top = theEvent.clientY+"px";
        showDiv.style.display = 'block';
        showDiv.style.overflow='auto'
        if(obj.innerHTML.length>200){
            showDiv.style.marginLeft='-650px';
        }else{
            showDiv.style.marginLeft='-300px';
        }
        showDiv.innerHTML = obj.innerHTML;
    }

    function outHidden(event) {
        var div = document.getElementById("showDiv");
        if(div.innerHTML.length>200){
            var x=event.clientX;
            var y=event.clientY;
            var divx1 = div.offsetLeft;
            var divy1 = div.offsetTop;
            var divx2 = div.offsetLeft + div.offsetWidth;
            var divy2 = div.offsetTop + div.offsetHeight;
            if( x < divx1 || x > divx2 || y < divy1 || y > divy2){
                div.style.display = 'none';
                div.innerHTML = '';
            }
        }else{
            div.style.display = 'none';
            div.innerHTML = '';
        }
    }





    $("#pageForm").form("submit", {
        url: "/customerProductParamApply/add",
        success: function (result) {

        }
    });


    function remarkTest () {
        $("#remarkTest").on('click', (function () {
            alert(1111);
            $("#queryUserListInfoForm").form("submit", {
                url: "/user/remarkTest",
                success: function (result) {

                }
            });
        }));
    }



</script>
</html>